{% extends 'index.html' %}

{% block content %}
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<style>
    .payment-container {
        background: gray;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        padding: 20px;
        max-width: 600px;
        margin: 40px auto;
    }
    .header {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 20px;
    }
    .detail {
        margin-bottom: 10px;
        font-size: 16px;
    }
    .btn-confirm {
        background-color: #4CAF50;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
    }
    .btn-confirm:hover {
        background-color: #45a049;
    }
</style>

<div class="payment-container">
    <div class="header">Finalize Your Payment</div>
    <div class="detail"><strong>Cinema Type:</strong> {{ cinema_type }}</div>
    <div class="detail"><strong>Movie Title:</strong> {{ movie_title }}</div>
    <div class="detail"><strong>Movie Duration:</strong> {{ movie_duration }} minutes</div>
    <div class="detail"><strong>Total Price:</strong> ${{ total_price }}</div>
    <div class="detail"><strong>Selected Seats:</strong> 
        <div id="seat-list">
            {% for seat in selected_seats %}
            <span class="seat-label" data-id="{{ seat.id }}">{{ seat.seat_label }}</span>{% if not forloop.last %}, {% endif %}
            {% endfor %}
        </div>
    </div>
    <button class="btn-confirm" onclick="confirmPayment()">Confirm Payment</button>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
    function confirmPayment() { 
        var cinemaHallId = "{{ cinema_hall_id }}";
        var movieId = "{{ movie_id }}";
        var totalPrice = "{{ total_price }}";
        var selectedSeats = [];
        
        $('#seat-list .seat-label').each(function() {
            selectedSeats.push($(this).data('id'));
        });

        console.log(selectedSeats)
    
        console.log("Cinema Hall ID:", cinemaHallId);
        console.log("Movie ID:", movieId);
        console.log("Selected Seats:", selectedSeats.join(','));
        console.log("Total Price:", totalPrice);
    
        $.post("/process-payment/", {
            cinema_hall_id: cinemaHallId,
            movie_id: movieId,
            seats: selectedSeats,  // Send as an array, not a string
            total_price: totalPrice,
            csrfmiddlewaretoken: $('input[name="csrfmiddlewaretoken"]').val()
        }, function(data) {
            if (data.success) {
                alert("Payment successful!");
                window.location.href = "/booking-success/";
            } else {
                alert("Payment failed. " + (data.error ? data.error : "Please try again."));
            }
        }).fail(function(jqXHR, textStatus) {
            alert("Request failed: " + textStatus);
        });
    }
    
    
</script>
{% endblock %}
